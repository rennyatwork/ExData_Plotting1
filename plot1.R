#setwd("C:\\Users\\renato\\Documents\\MOOC\\2014\\course04 - ExploratoryDataAnalysis\\Assignment-01\\ExData_Plotting1")

initialize <-function()
{
  require(sqldf)
  #read.csv.sql(paste(paste(getwd(),"/exdata_data_household_power_consumption", sep=""),"/household_power_consumption.txt", sep=""), sql = "select * from file", header=T, sep=";")  
}

getDt <-function()
{  
   dt <- read.csv.sql(paste(paste(getwd(),"/exdata_data_household_power_consumption", sep=""),"/household_power_consumption.txt", sep=""), sql = "select * from file WHERE Date = '1/2/2007' OR Date ='2/2/2007' ", header=T, sep=";")
   dt <- transform(dt, Date = factor(Date))
   dt$dateTime <- strptime(paste(dt$Date, dt$Time), "%d/%m/%Y %H:%M:%S")    
  
  return (dt)
}

plot1 <- function()
{
  dt<-getDt()
  hist(dt$Global_active_power, col='red', xlab='Global Active Power (kilowatts)', main='Global Active Power')
  #dev.copy(png, "plot1.png", width=480, height=480)
  # dev.off()
  saveAndClose("plot1")
}

saveAndClose <- function(pName)
{
  dev.copy(png, paste(pName, ".png", sep=""), width=480, height=480)
  dev.off()
}
#require(sqldf)
#read.csv.sql(paste(paste(getwd(),"/exdata_data_household_power_consumption", sep=""),"/household_power_consumption.txt", sep=""), sql = "select * from file", header=T, sep=";")
#dt <- read.csv.sql(paste(paste(getwd(),"/exdata_data_household_power_consumption", sep=""),"/household_power_consumption.txt", sep=""), sql = "select * from file WHERE Date = '1/2/2007' OR Date ='2/2/2007' ", header=T, sep=";")
#hist(dt$Global_active_power, col='red', xlab='Global Active Power (kilowatts)', main='Global Active Power')
#dev.copy(png, "plot1.png", width=480, height=480)
# dev.off()

#plot2
#dt <- transform(dt, Date = factor(Date))
# plot(Global_active_power ~ Date, dt, xlab='Date', ylab="Global Active Power")
#dt$wkday <- weekdays(as.Date(dt$Date, '%d/%m/%Y'))
#plot(x=dt$dateTime, y=dt$Global_active_power, type='l', ylab="Global Active Power (kilowatts)", xlab="")
#dev.copy(png, "plot2.png", width=480, height=480)
# dev.off()

#plot3
#plot(x=dt$dateTime, y=dt$Sub_metering_1, type='l' ,ylab="Energy sub metering", xlab="")
#points(x=dt$dateTime, y=dt$Sub_metering_2, type='l', col='red')
#points(x=dt$dateTime, y=dt$Sub_metering_3, type='l', col='blue')
#legend('topright', legend=c('Sub_metering_1', 'Sub_metering_2', 'Sub_metering_3'), col=c('black', 'red', 'blue'), lwd=1)
#dev.copy(png, "plot2.png", width=480, height=480)
# dev.off()

#plot 4
# first graph:
#  plot(x=dt$dateTime, y=dt$Global_active_power, type='l' ,ylab="Global Active Power", xlab="")
# second graph:
#  plot(x=dt$dateTime, y=dt$Voltage, type='l' ,ylab="Voltage", xlab="datetime")
# third graph: see plot 3
# fourth graph
#  plot(x=dt$dateTime, y=dt$Global_reactive_power, type='l' ,ylab="Global Active Power", xlab="")